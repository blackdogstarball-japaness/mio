<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>日本餐廳像素冒險</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Press Start 2P', 'Noto Sans TC', sans-serif;
            background-color: #f5f5f0;
            background-image: linear-gradient(45deg, #e0e0d8 25%, transparent 25%), linear-gradient(-45deg, #e0e0d8 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #e0e0d8 75%), linear-gradient(-45deg, transparent 75%, #e0e0d8 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            overscroll-behavior-y: none;
        }
        .pixel-box {
            border: 4px solid #333333;
            box-shadow: 6px 6px 0px 0px #555555;
        }
        .pixel-btn {
            border: 4px solid #333333;
            box-shadow: 4px 4px 0px 0px #555555;
            transition: all 0.1s;
        }
        .pixel-btn:hover {
            box-shadow: 2px 2px 0px 0px #555555;
            transform: translate(2px, 2px) scale(1.02);
        }
        .pixel-btn:active {
            box-shadow: 0px 0px 0px 0px #555555;
            transform: translate(4px, 4px);
        }
        .typing-animation::after {
            content: '|';
            animation: blink-caret 0.75s step-end infinite;
        }
        @keyframes blink-caret {
            from, to { visibility: hidden; }
            50% { visibility: visible; }
        }
        .animate-pop-in {
            animation: pop-in 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
        @keyframes pop-in {
            0% { transform: scale(0.9); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0px rgba(164, 210, 159, 0.7); }
            50% { box-shadow: 0 0 0 4px rgba(164, 210, 159, 0); }
        }
        .pulse-animation {
            animation: pulse 1.5s infinite;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div id="app" class="bg-gray-100 text-gray-800 p-8 rounded-none pixel-box w-full max-w-2xl animate-pop-in">
        <h1 class="text-xl sm:text-2xl text-center mb-6 text-[#d9c08d]">日本餐廳像素冒險</h1>

        <!-- 進度條區塊 -->
        <div id="progress-bar-container" class="flex justify-between items-center mb-8 text-xs sm:text-sm text-center">
            <div id="step-greeting" class="progress-step flex-1 px-1 sm:px-2 py-1 bg-[#a4d29f] text-gray-800 font-semibold rounded-none pulse-animation">入店</div>
            <div class="flex-1 border-t-2 border-gray-400 mx-2"></div>
            <div id="step-seating" class="progress-step flex-1 px-1 sm:px-2 py-1 bg-gray-300 text-gray-500 font-semibold rounded-none">入座</div>
            <div class="flex-1 border-t-2 border-gray-400 mx-2"></div>
            <div id="step-ordering" class="progress-step flex-1 px-1 sm:px-2 py-1 bg-gray-300 text-gray-500 font-semibold rounded-none">點餐</div>
            <div class="flex-1 border-t-2 border-gray-400 mx-2"></div>
            <div id="step-payment" class="progress-step flex-1 px-1 sm:px-2 py-1 bg-gray-300 text-gray-500 font-semibold rounded-none">結帳</div>
        </div>

        <div class="space-y-6">
            <!-- 服務生訊息區塊 -->
            <div id="waiter-message-container" class="bg-[#e6f0f3] text-gray-700 p-6 rounded-none pixel-box animate-pop-in">
                <p id="waiter-text" class="text-sm sm:text-base"></p>
            </div>

            <!-- 用戶選項區塊 -->
            <div id="user-options-container" class="flex flex-col space-y-4 animate-pop-in">
                <button onclick="handleChoice('二人')" class="choice-btn bg-gray-200 text-gray-800 py-3 px-6 rounded-none pixel-btn">
                    <span class="font-semibold">二人</span>
                </button>
                <button onclick="handleChoice('一人')" class="choice-btn bg-gray-200 text-gray-800 py-3 px-6 rounded-none pixel-btn">
                    <span class="font-semibold">一人</span>
                </button>
                <button onclick="handleChoice('三人')" class="choice-btn bg-gray-200 text-gray-800 py-3 px-6 rounded-none pixel-btn">
                    <span class="font-semibold">三人</span>
                </button>
                <button onclick="handleChoice('テイクアウト')" class="choice-btn bg-gray-200 text-gray-800 py-3 px-6 rounded-none pixel-btn">
                    <span class="font-semibold">テイクアウト</span>
                </button>
            </div>
            
            <!-- 點餐菜單區塊 (預設隱藏) -->
            <div id="menu-container" class="hidden bg-gray-200 p-6 rounded-none pixel-box animate-pop-in">
                <h2 class="text-lg font-bold mb-4 text-[#d9c08d]">メニュー</h2>
                <div id="menu-items" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <!-- 菜單項目將由 JS 動態生成 -->
                </div>
                <div id="ordered-items-container" class="mt-6 hidden">
                    <h3 class="text-base font-bold text-[#d9c08d] mb-2">ご注文</h3>
                    <ul id="ordered-items" class="list-disc pl-5 text-gray-600 space-y-1"></ul>
                    <p id="total-price" class="text-lg font-bold text-[#d9c08d] mt-4"></p>
                </div>
                <button id="order-done-btn" onclick="handleChoice('注文完了')" class="hidden w-full mt-6 py-3 px-6 bg-[#a4d29f] text-gray-800 font-semibold rounded-none pixel-btn">
                    <span class="font-semibold">注文完了</span>
                </button>
            </div>

            <!-- 結帳按鈕區塊 (預設隱藏) -->
            <div id="payment-options-container" class="hidden flex flex-col space-y-4 animate-pop-in">
                <button onclick="handlePaymentMethod('現金')" class="choice-btn bg-gray-200 text-gray-800 py-3 px-6 rounded-none pixel-btn">
                    <span class="font-semibold">現金</span>
                </button>
                <button onclick="handlePaymentMethod('クレジットカード')" class="choice-btn bg-gray-200 text-gray-800 py-3 px-6 rounded-none pixel-btn">
                    <span class="font-semibold">クレジットカード</span>
                </button>
                <button onclick="handlePaymentMethod('電子マネー')" class="choice-btn bg-gray-200 text-gray-800 py-3 px-6 rounded-none pixel-btn">
                    <span class="font-semibold">電子マネー</span>
                </button>
            </div>
            
            <!-- 動態支付區塊 (現金支付時顯示) -->
            <div id="dynamic-payment-content" class="hidden bg-gray-200 p-6 rounded-none pixel-box animate-pop-in">
                <h3 class="text-base font-bold text-[#d9c08d] mb-2">現金支払い</h3>
                <p id="cash-prompt" class="text-gray-600 mb-4"></p>
                <input type="number" id="cash-input" class="w-full p-3 border-4 border-gray-600 bg-gray-100 text-gray-800 focus:outline-none focus:ring-2 focus:ring-[#a4d29f]" placeholder="金額を入力してください">
                <button onclick="handleCashPayment()" class="w-full mt-4 py-3 px-6 bg-[#a4d29f] text-gray-800 font-semibold rounded-none pixel-btn">
                    <span class="font-semibold">支払う</span>
                </button>
            </div>

            <!-- 重新開始按鈕區塊 (預設隱藏) -->
            <div id="restart-container" class="hidden text-center mt-6 animate-pop-in">
                <button onclick="restart()" class="w-full sm:w-auto py-3 px-8 bg-gray-300 text-gray-800 font-semibold rounded-none pixel-btn">
                    <span class="font-semibold">最初に戻る</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // DOM 元素引用
        const waiterTextEl = document.getElementById('waiter-text');
        const userOptionsContainer = document.getElementById('user-options-container');
        const menuContainer = document.getElementById('menu-container');
        const menuItemsContainer = document.getElementById('menu-items');
        const orderedItemsContainer = document.getElementById('ordered-items-container');
        const orderedItemsEl = document.getElementById('ordered-items');
        const orderDoneBtn = document.getElementById('order-done-btn');
        const paymentOptionsContainer = document.getElementById('payment-options-container');
        const restartContainer = document.getElementById('restart-container');
        const totalPriceEl = document.getElementById('total-price');
        const dynamicPaymentContent = document.getElementById('dynamic-payment-content');
        const cashPromptEl = document.getElementById('cash-prompt');
        const cashInputEl = document.getElementById('cash-input');

        // 進度條元素引用
        const progressBarSteps = {
            greeting: document.getElementById('step-greeting'),
            seating: document.getElementById('step-seating'),
            ordering: document.getElementById('step-ordering'),
            payment: document.getElementById('step-payment'),
        };

        // 應用程式狀態
        let currentStage = 'greeting';
        let orderedItems = [];
        let totalAmount = 0;
        let dialogueQueue = [];
        const DIALOGUE_DELAY = 10000; // 10 秒延遲

        // 菜單資料
        const menu = [
            { name: '壽司', price: 120, jp: '寿司' },
            { name: '拉麵', price: 250, jp: 'ラーメン' },
            { name: '天婦羅', price: 180, jp: '天ぷら' },
            { name: '生魚片', price: 300, jp: '刺身' },
            { name: '章魚燒', price: 80, jp: 'たこ焼き' },
            { name: '炸豬排', price: 200, jp: 'とんかつ' },
            { name: '丼飯', price: 150, jp: 'どんぶり' },
            { name: '烏龍麵', price: 180, jp: 'うどん' },
            { name: '蕎麥麵', price: 180, jp: 'そば' },
            { name: '烤雞肉串', price: 100, jp: '焼き鳥' },
            { name: '味噌湯', price: 50, jp: '味噌汁' },
            { name: '綠茶', price: 30, jp: 'お茶' },
        ];

        // 動態打字效果
        function typeMessage(element, text) {
            return new Promise(resolve => {
                element.textContent = '';
                let i = 0;
                const typingInterval = setInterval(() => {
                    if (i < text.length) {
                        element.textContent += text.charAt(i);
                        i++;
                    } else {
                        clearInterval(typingInterval);
                        resolve();
                    }
                }, 50);
            });
        }

        // 更新進度條樣式
        function updateProgressBar(stage) {
            Object.keys(progressBarSteps).forEach(key => {
                const step = progressBarSteps[key];
                step.classList.remove('bg-[#a4d29f]', 'text-gray-800', 'bg-gray-300', 'text-gray-500', 'pulse-animation');
                if (key === stage) {
                    step.classList.add('bg-[#a4d29f]', 'text-gray-800', 'pulse-animation');
                } else {
                    step.classList.add('bg-gray-300', 'text-gray-500');
                }
            });
        }

        // 處理用戶點擊事件，根據當前階段調用不同函數
        function handleChoice(choice) {
            switch (currentStage) {
                case 'greeting':
                    handleGreetingChoice(choice);
                    break;
                case 'ordering':
                    handleOrderingChoice(choice);
                    break;
                case 'duringMeal':
                    handleMidMealChoice(choice);
                    break;
                case 'paymentQuestion':
                    handlePaymentQuestionChoice(choice);
                    break;
                case 'paymentMethod':
                    handlePaymentMethod(choice);
                    break;
                case 'farewell':
                    handleFarewellChoice(choice);
                    break;
            }
        }

        // 處理入店階段的選擇
        function handleGreetingChoice(choice) {
            userOptionsContainer.classList.add('hidden');
            let dialogueText = '';
            let nextAction = null;

            if (choice === 'テイクアウト') {
                dialogueText = 'はい、お持ち帰りですね。こちらでご注文をどうぞ。';
                nextAction = () => {
                    updateProgressBar('ordering');
                    showMenu();
                    currentStage = 'ordering';
                };
            } else if (choice === '一人') {
                dialogueText = 'かしこまりました。カウンター席へどうぞ。';
                nextAction = showOrderingChoices;
            } else if (choice === '二人') {
                dialogueText = 'かしこまりました。こちらのテーブル席へどうぞ。';
                nextAction = showOrderingChoices;
            } else if (choice === '三人') {
                dialogueText = '少々お待ちください。今、お席を準備いたします。';
                nextAction = showOrderingChoices;
            }

            typeMessage(waiterTextEl, dialogueText).then(() => {
                 setTimeout(() => {
                     if (nextAction) nextAction();
                 }, DIALOGUE_DELAY);
            });
        }

        // 顯示點餐選擇
        function showOrderingChoices() {
            updateProgressBar('seating');
            currentStage = 'ordering';
            userOptionsContainer.innerHTML = `
                <button onclick="handleChoice('ラーメンをください')" class="choice-btn bg-gray-200 text-gray-800 py-3 px-6 rounded-none pixel-btn">
                    <span class="font-semibold">ラーメンをください</span>
                </button>
                <button onclick="handleChoice('おすすめは何ですか？')" class="choice-btn bg-gray-200 text-gray-800 py-3 px-6 rounded-none pixel-btn">
                    <span class="font-semibold">おすすめは何ですか？</span>
                </button>
                <button onclick="handleChoice('もう少し考えます')" class="choice-btn bg-gray-200 text-gray-800 py-3 px-6 rounded-none pixel-btn">
                    <span class="font-semibold">もう少し考えます</span>
                </button>
            `;
            userOptionsContainer.classList.remove('hidden');
            typeMessage(waiterTextEl, 'お決まりになりましたか？');
        }

        // 處理點餐階段的選擇
        function handleOrderingChoice(choice) {
            userOptionsContainer.classList.add('hidden');
            let dialogueText = '';
            let nextAction = null;

            if (choice === 'ラーメンをください') {
                dialogueText = 'ラーメンですね。かしこまりました。';
                orderedItems.push(menu.find(item => item.name === '拉麵'));
                nextAction = showMenuAfterOrder;
            } else if (choice === 'おすすめは何ですか？') {
                dialogueText = '今のおすすめは焼き魚定食です。とても人気ですよ。';
                nextAction = () => {
                    setTimeout(() => {
                        userOptionsContainer.innerHTML = `
                            <button onclick="handleChoice('焼き魚定食をください')" class="choice-btn bg-gray-200 text-gray-800 py-3 px-6 rounded-none pixel-btn">
                                <span class="font-semibold">焼き魚定食をください</span>
                            </button>
                            <button onclick="showMenu()" class="choice-btn bg-gray-200 text-gray-800 py-3 px-6 rounded-none pixel-btn">
                                <span class="font-semibold">他のメニューを見る</span>
                            </button>
                        `;
                        userOptionsContainer.classList.remove('hidden');
                        currentStage = 'ordering';
                    }, DIALOGUE_DELAY);
                };
            } else if (choice === 'もう少し考えます') {
                dialogueText = 'はい、ごゆっくりどうぞ。';
                nextAction = () => {
                     setTimeout(() => {
                        showMenu();
                        currentStage = 'ordering';
                    }, DIALOGUE_DELAY);
                };
            } else if (choice === '注文完了') {
                dialogueText = 'かしこまりました。お料理はすぐにお持ちしますので、少々お待ちください。';
                nextAction = showMidMealDialogue;
            } else if (choice === '焼き魚定食をください') {
                dialogueText = '焼き魚定食ですね。かしこまりました。';
                orderedItems.push({ name: '焼き魚定食', price: 280, jp: '焼き魚定食' });
                nextAction = showMenuAfterOrder;
            }
             
            typeMessage(waiterTextEl, dialogueText).then(() => {
                setTimeout(() => {
                    if(nextAction) nextAction();
                }, DIALOGUE_DELAY);
            });
        }
        
        function showMenuAfterOrder() {
            updateOrderedItemsDisplay();
            updateTotal();
            orderDoneBtn.classList.remove('hidden');
            menuContainer.classList.remove('hidden');
            userOptionsContainer.classList.add('hidden');
            typeMessage(waiterTextEl, 'ご注文を承りました。他に何かございますか？');
        }
        
        // 顯示用餐中對話
        function showMidMealDialogue() {
            updateProgressBar('ordering');
            menuContainer.classList.add('hidden');
            currentStage = 'duringMeal';
            userOptionsContainer.classList.remove('hidden');
            userOptionsContainer.innerHTML = `
                <button onclick="handleChoice('とてもおいしいです')" class="choice-btn bg-gray-200 text-gray-800 py-3 px-6 rounded-none pixel-btn">
                    <span class="font-semibold">とてもおいしいです</span>
                </button>
                <button onclick="handleChoice('お水をいただけますか？')" class="choice-btn bg-gray-200 text-gray-800 py-3 px-6 rounded-none pixel-btn">
                    <span class="font-semibold">お水をいただけますか？</span>
                </button>
                <button onclick="handleChoice('すみません、箸を落としました')" class="choice-btn bg-gray-200 text-gray-800 py-3 px-6 rounded-none pixel-btn">
                    <span class="font-semibold">すみません、箸を落としました</span>
                </button>
            `;
            typeMessage(waiterTextEl, 'お味はいかがですか？');
        }

        // 處理用餐中選擇
        function handleMidMealChoice(choice) {
            userOptionsContainer.classList.add('hidden');
            let dialogueText = '';
            let nextAction = null;

            if (choice === 'とてもおいしいです') {
                dialogueText = 'ありがとうございます。ごゆっくりどうぞ。';
            } else if (choice === 'お水をいただけますか？') {
                dialogueText = 'かしこまりました。すぐお持ちします。';
            } else if (choice === 'すみません、箸を落としました') {
                dialogueText = '失礼いたしました。新しいお箸をお持ちします。';
            }
            nextAction = showPaymentQuestion;
            typeMessage(waiterTextEl, dialogueText).then(() => {
                setTimeout(() => {
                    if (nextAction) nextAction();
                }, DIALOGUE_DELAY);
            });
        }

        function showPaymentQuestion() {
            updateProgressBar('payment');
            currentStage = 'paymentQuestion';
            userOptionsContainer.classList.remove('hidden');
            userOptionsContainer.innerHTML = `
                <button onclick="handleChoice('はい、一緒で')" class="choice-btn bg-gray-200 text-gray-800 py-3 px-6 rounded-none pixel-btn">
                    <span class="font-semibold">はい、一緒で</span>
                </button>
                <button onclick="handleChoice('別々でお願いします')" class="choice-btn bg-gray-200 text-gray-800 py-3 px-6 rounded-none pixel-btn">
                    <span class="font-semibold">別々でお願いします</span>
                </button>
                <button onclick="handleChoice('クレジットカードは使えますか？')" class="choice-btn bg-gray-200 text-gray-800 py-3 px-6 rounded-none pixel-btn">
                    <span class="font-semibold">クレジットカードは使えますか？</span>
                </button>
            `;
            typeMessage(waiterTextEl, 'お会計はご一緒でよろしいですか？');
        }

        // 處理結帳問題
        function handlePaymentQuestionChoice(choice) {
            userOptionsContainer.classList.add('hidden');
            let dialogueText = '';
            let nextAction = null;
            if (choice === 'はい、一緒で') {
                dialogueText = 'かしこまりました。お支払いは現金ですか？クレジットカードですか？電子マネーもご利用いただけます。';
                nextAction = () => {
                    currentStage = 'paymentMethod';
                    paymentOptionsContainer.classList.remove('hidden');
                };
            } else if (choice === '別々でお願いします') {
                dialogueText = 'かしこまりました。別々でお願いします。';
                 nextAction = () => {
                    currentStage = 'paymentMethod';
                    paymentOptionsContainer.classList.remove('hidden');
                };
            } else if (choice === 'クレジットカードは使えますか？') {
                 dialogueText = 'はい、ご利用いただけます。お支払いは現金ですか？クレジットカードですか？電子マネーもご利用いただけます。';
                 nextAction = () => {
                    currentStage = 'paymentMethod';
                    paymentOptionsContainer.classList.remove('hidden');
                };
            }
            typeMessage(waiterTextEl, dialogueText).then(() => {
                setTimeout(() => {
                    if(nextAction) nextAction();
                }, DIALOGUE_DELAY);
            });
        }

        // 處理結帳方式選擇
        function handlePaymentMethod(method) {
            paymentOptionsContainer.classList.add('hidden');
            let dialogueText = '';
            let nextAction = null;

            if (method === '現金') {
                dialogueText = `かしこまりました。${totalAmount}円になります。`;
                nextAction = () => {
                    cashPromptEl.textContent = `合計金額は¥${totalAmount}でございます。`;
                    dynamicPaymentContent.classList.remove('hidden');
                };
            } else if (method === 'クレジットカード') {
                dialogueText = 'クレジットカードですね。こちらにお差し込みください。';
                nextAction = () => {
                    typeMessage(waiterTextEl, '暗証番号をご入力ください。').then(() => {
                        // In a real app, this would be user interaction, here we simulate it
                        setTimeout(() => {
                            typeMessage(waiterTextEl, 'ありがとうございました。レシートになります。').then(thanksAndFarewell);
                        }, DIALOGUE_DELAY);
                    });
                };
            } else if (method === '電子マネー') {
                dialogueText = 'はい、ご利用いただけます。Suica / PayPay / LINE Payなどが使えます。';
                nextAction = () => {
                    typeMessage(waiterTextEl, 'こちらにタッチしてください。').then(() => {
                        // Simulate touch payment
                        setTimeout(() => {
                            typeMessage(waiterTextEl, '決済が完了しました。ありがとうございました。').then(thanksAndFarewell);
                        }, DIALOGUE_DELAY);
                    });
                };
            }
            
            typeMessage(waiterTextEl, dialogueText).then(() => {
                setTimeout(() => {
                    if (nextAction) nextAction();
                }, DIALOGUE_DELAY);
            });
        }

        // 處理現金支付
        function handleCashPayment() {
            const paidAmount = parseInt(cashInputEl.value, 10);
            dynamicPaymentContent.classList.add('hidden');
            let dialogueText = '';
            
            if (isNaN(paidAmount) || paidAmount < totalAmount) {
                dialogueText = 'すみません、金額が足りません。もう一度お願いします。';
                typeMessage(waiterTextEl, dialogueText).then(() => {
                    dynamicPaymentContent.classList.remove('hidden');
                    cashInputEl.value = '';
                });
                return;
            } else if (paidAmount === totalAmount) {
                dialogueText = `${totalAmount}円ちょうどお預かりします。ありがとうございました。`;
            } else {
                const change = paidAmount - totalAmount;
                dialogueText = `${paidAmount}円お預かりいたします。お釣り、${change}円です。どうぞ。`;
            }
            
            typeMessage(waiterTextEl, dialogueText).then(() => {
                setTimeout(thanksAndFarewell, DIALOGUE_DELAY);
            });
        }

        // 結尾並顯示重新開始按鈕
        function thanksAndFarewell() {
            currentStage = 'farewell';
            userOptionsContainer.classList.remove('hidden');
            userOptionsContainer.innerHTML = `
                <button onclick="handleChoice('ごちそうさまでした')" class="choice-btn bg-gray-200 text-gray-800 py-3 px-6 rounded-none pixel-btn">
                    <span class="font-semibold">ごちそうさまでした</span>
                </button>
                <button onclick="handleChoice('美味しかったです')" class="choice-btn bg-gray-200 text-gray-800 py-3 px-6 rounded-none pixel-btn">
                    <span class="font-semibold">美味しかったです</span>
                </button>
                <button onclick="handleChoice('また来ます！')" class="choice-btn bg-gray-200 text-gray-800 py-3 px-6 rounded-none pixel-btn">
                    <span class="font-semibold">また来ます！</span>
                </button>
            `;
            typeMessage(waiterTextEl, 'ありがとうございました。またのご来店をお待ちしております。');
        }

        function handleFarewellChoice(choice) {
            userOptionsContainer.classList.add('hidden');
            typeMessage(waiterTextEl, 'はい、またのお越しをお待ちしております。').then(() => {
                setTimeout(() => {
                    restartContainer.classList.remove('hidden');
                }, DIALOGUE_DELAY);
            });
        }

        // 顯示菜單
        function showMenu() {
            userOptionsContainer.classList.add('hidden');
            menuContainer.classList.remove('hidden');
            menuItemsContainer.innerHTML = '';
            menu.forEach(item => {
                const btn = document.createElement('button');
                btn.className = 'bg-gray-200 p-4 rounded-none pixel-btn text-left text-gray-800';
                btn.innerHTML = `<h3 class="font-bold text-base">${item.jp} <span class="text-xs text-gray-500">(${item.name})</span></h3><p class="text-xs text-gray-500">¥${item.price}</p>`;
                btn.onclick = () => addOrderItem(item);
                menuItemsContainer.appendChild(btn);
            });
        }

        // 添加已點餐點
        function addOrderItem(item) {
            orderedItems.push(item);
            updateOrderedItemsDisplay();
            updateTotal();
            orderDoneBtn.classList.remove('hidden');
            typeMessage(waiterTextEl, 'ご注文を承りました。他に何かございますか？');
        }

        // 更新已點餐點列表
        function updateOrderedItemsDisplay() {
            orderedItemsContainer.classList.remove('hidden');
            orderedItemsEl.innerHTML = '';
            orderedItems.forEach(item => {
                const li = document.createElement('li');
                li.className = 'text-gray-600';
                li.textContent = `${item.jp}`;
                orderedItemsEl.appendChild(li);
            });
        }
        
        // 更新總金額
        function updateTotal() {
            totalAmount = orderedItems.reduce((sum, item) => sum + item.price, 0);
            totalPriceEl.textContent = `合計金額：¥${totalAmount}`;
        }

        // 重新開始
        function restart() {
            orderedItems = [];
            currentStage = 'greeting';
            totalAmount = 0;
            dialogueQueue = [];
            
            updateProgressBar('greeting');
            typeMessage(waiterTextEl, 'いらっしゃいませ！何名様ですか？');
            userOptionsContainer.classList.remove('hidden');
            userOptionsContainer.innerHTML = `
                <button onclick="handleChoice('一人')" class="choice-btn bg-gray-200 text-gray-800 py-3 px-6 rounded-none pixel-btn">
                    <span class="font-semibold">一人</span>
                </button>
                <button onclick="handleChoice('二人')" class="choice-btn bg-gray-200 text-gray-800 py-3 px-6 rounded-none pixel-btn">
                    <span class="font-semibold">二人</span>
                </button>
                <button onclick="handleChoice('三人')" class="choice-btn bg-gray-200 text-gray-800 py-3 px-6 rounded-none pixel-btn">
                    <span class="font-semibold">三人</span>
                </button>
                <button onclick="handleChoice('テイクアウト')" class="choice-btn bg-gray-200 text-gray-800 py-3 px-6 rounded-none pixel-btn">
                    <span class="font-semibold">テイクアウト</span>
                </button>
            `;
            menuContainer.classList.add('hidden');
            orderedItemsContainer.classList.add('hidden');
            orderDoneBtn.classList.add('hidden');
            paymentOptionsContainer.classList.add('hidden');
            restartContainer.classList.add('hidden');
            dynamicPaymentContent.classList.add('hidden');
            totalPriceEl.textContent = '';
            cashInputEl.value = '';
        }

        // 初始狀態：在頁面載入時啟動
        window.onload = function() {
            restart();
        };
    </script>
</body>
</html>
